(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{33685:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(61878)}])},61878:function(e,t,n){"use strict";n.r(t);var r=n(34051),o=n.n(r),c=n(85893),a=n(67294),s=n(66599);function i(e,t,n,r,o,c,a){try{var s=e[c](a),i=s.value}catch(u){return void n(u)}s.done?t(i):Promise.resolve(i).then(r,o)}function u(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var c=e.apply(t,n);function a(e){i(c,r,o,a,s,"next",e)}function s(e){i(c,r,o,a,s,"throw",e)}a(void 0)}))}}n(78428);t.default=function(){var e=(0,a.useState)(void 0),t=e[0],n=e[1],r=(0,a.useState)(void 0),i=(r[0],r[1]),p=(0,a.useState)(void 0),l=p[0],d=p[1],f=(0,a.useState)(void 0),h=(f[0],f[1]),v=(0,a.useState)(void 0),x=v[0],g=v[1],m=(0,a.useState)(void 0),w=(m[0],m[1]),S=(0,a.useState)(void 0),k=(S[0],S[1]),y=(0,a.useState)(void 0),b=y[0],j=y[1],T=(0,a.useState)(void 0),I=T[0],C=T[1],P=(0,a.useState)(void 0),E=(P[0],P[1]),O=function(){var e=document.getElementById("articleTitle").value,t=document.getElementById("articleContent").value;D(),A(t,e)},D=function(){n(void 0),i(void 0),h(void 0),g(void 0)},A=(function(){var e=u(o().mark((function e(t){var r,c,a,u,p,l,d,f;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(""),console.log("    STARTING JOB"),n("In progress..."),r=new Date,e.next=6,(0,s.textToSpeechAzure)(t);case 6:return c=e.sent,a=new Date,n("Completed in ".concat((a-r)/1e3," seconds")),i("In progress..."),u=new Date,e.next=14,U(c);case 14:return p=e.sent,l=new Date,i("Completed in ".concat((l-u)/1e3," seconds")),d=(l-r)/1e3,console.log("    JOB COMPLETED IN ".concat(d," SECONDS")),console.log("File available at location: ".concat(p.Location)),console.log(""),g(d),e.next=25,(0,s.getPresignedBucketUrl)(p.Location);case 25:f=e.sent,h(f);case 27:case"end":return e.stop()}}),e)})))}(),function(){var e=u(o().mark((function e(t,r){var c,a,i,p,l,f,h,v,x;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(""),console.log("    STARTING JOB"),n("In progress..."),c=new Date,"https://text-to-speech-html-nps3rxjiya-ew.a.run.app",e.next=7,fetch("https://text-to-speech-html-nps3rxjiya-ew.a.run.app",{method:"POST",body:JSON.stringify({textToConvert:t})});case 7:return a=e.sent,e.next=10,a.json();case 10:return i=e.sent,console.log("CUSTOM LOGGING - jsonContent",i),void 0,p=new Date,n("Completed in ".concat((p-c)/1e3," seconds")),k(i.mp3Url),console.log(""),l=new Date,e.next=21,(0,s.createMegaphonePodcastEpisode)(r,i.mp3Url);case 21:f=e.sent,h=new Date,d("Completed in ".concat((h-l)/1e3," seconds")),console.log("podcastEpisode",f),w(f),j(f.uid),C(!0),v=setInterval(u(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,(0,s.getEpisodeDetail)(f.id);case 4:t=e.sent,console.log("check episodeDetail",t),t&&console.log("Audio processing?",t.audioFileProcessing?"si":"no"),!t.audioFileProcessing&&v&&(console.log("Clearing timeout"),console.log("checkEpisodeProcessing",v),clearInterval(v),C(!1));case 8:case"end":return e.stop()}}),e)}))),1e3),E(v),x=(h-c)/1e3,console.log(""),g(x);case 34:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),U=(function(){var e=u(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,textToSpeech(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))}(),function(){var e=u(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.speechToS3Bucket)(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());return(0,c.jsxs)("div",{children:[(0,c.jsx)("h1",{children:'Converting text through Azure "text-to-speech" service and saving the mp3 output to an AWS S3 Bucket'}),(0,c.jsxs)("div",{children:[(0,c.jsx)("b",{children:"Article title:"}),(0,c.jsx)("br",{}),(0,c.jsx)("br",{}),(0,c.jsx)("input",{type:"text",id:"articleTitle",size:"100"}),(0,c.jsx)("br",{}),(0,c.jsx)("br",{}),(0,c.jsx)("b",{children:"Article content:"}),(0,c.jsx)("br",{}),(0,c.jsx)("br",{}),(0,c.jsx)("textarea",{id:"articleContent",cols:"100",rows:"10",defaultValue:""}),(0,c.jsx)("br",{}),(0,c.jsx)("br",{}),(0,c.jsx)("button",{onClick:O,children:"Convert"})]}),t&&(0,c.jsxs)("div",{children:[(0,c.jsx)("h2",{children:"Convertion status:"}),(0,c.jsxs)("ul",{children:[(0,c.jsxs)("li",{children:["Text to speech convertion: ",t]}),(0,c.jsxs)("li",{children:["Megaphone episode creation: ",l]}),(0,c.jsxs)("li",{children:["Megaphone episode processing: ",I?"Processing":"Completed"]})]}),(0,c.jsx)("br",{}),x?(0,c.jsxs)("b",{children:["Convertion time: ",x," seconds"]}):null]}),b&&!I&&function(){var e="https://playlist.megaphone.fm?e=".concat(b);return(0,c.jsx)("div",{children:(0,c.jsx)("iframe",{frameborder:"0",height:"200",scrolling:"no",src:e,width:"100%"})})}()]})}},66599:function(e,t,n){"use strict";var r=n(83454);Object.defineProperty(t,"__esModule",{value:!0}),t.getEpisodeDetail=t.createMegaphonePodcastEpisode=t.getPresignedBucketUrl=t.speechToS3Bucket=t.textToSpeechAzure=t.textToSpeechReadSpeakerPoc=t.textToSpeechReadSpeaker=void 0;var o,c=(o=n(34051))&&o.__esModule?o:{default:o},a=n(15910),s=n(78061);function i(e,t,n,r,o,c,a){try{var s=e[c](a),i=s.value}catch(u){return void n(u)}s.done?t(i):Promise.resolve(i).then(r,o)}function u(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var c=e.apply(t,n);function a(e){i(c,r,o,a,s,"next",e)}function s(e){i(c,r,o,a,s,"throw",e)}a(void 0)}))}}var p=n(74135),l=n(48764).Buffer,d=n(98690);d.config.update({accessKeyId:"AKIAVFQ4KCDO3GID4XSG",secretAccessKey:"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"});var f=function(){var e=u(c.default.mark((function e(t){var n,r,o;return c.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="https://scapi-eu.readspeaker.com/a/speak",n+="?key=".concat("dd8e75c0bd4bd98068970d9a91530835"),n+="&command=".concat("produce"),n+="&text=".concat(t),n+="&lang=".concat("it_it"),n+="&voice=".concat("Elisa"),e.next=8,fetch(n);case 8:return r=e.sent,e.next=11,r.body.getReader().read();case 11:return o=e.sent,e.abrupt("return",o.value);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.textToSpeechReadSpeaker=f;var h=function(){var e=u(c.default.mark((function e(t){var n,r,o,a,s,i,u,p;return c.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a in n="https://app-eu.readspeaker.com/cgi-bin/rsent",console.log("readSpeakerUrl",n),o=[],r={customerid:"5110",lang:"it_it",stattype:"StreamingAPI",statparam:"Test",audioformat:"mp3",text:t})s=encodeURIComponent(a),i=encodeURIComponent(r[a]),o.push(s+"="+i);return o=o.join("&"),console.log("formBody",o),e.next=9,fetch(n,{method:"POST","Content-Type":"application/x-www-form-urlencoded;charset=UTF-8",headers:{"x-readspeaker-api-key":"kywUNz8WQOH8gYlUIPqXfQFN4cLqNA3pWSOzXkcC"},body:o});case 9:return u=e.sent,console.log("readSpeakerStream",u),e.next=13,u.body.getReader().read();case 13:return p=e.sent,console.log("streamRead",p),e.abrupt("return",p.value);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.textToSpeechReadSpeakerPoc=h;var v=function(){var e=u(c.default.mark((function e(t){return c.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=p.SpeechConfig.fromSubscription("51566c6d710a4929a44726b29bcaa686","westeurope");r.speechSynthesisOutputFormat=5,r.speechSynthesisLanguage="it-IT",r.speechSynthesisVoiceName="it-IT-IsabellaNeural";var o=new p.SpeechSynthesizer(r,null);o.speakTextAsync(t,(function(t){var n=t.audioData;o.close(),e(l.from(n))}),(function(e){o.close(),n(e)}))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.textToSpeechAzure=v;var x=function(){var e=u(c.default.mark((function e(t){var n,r,o;return c.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new d.S3,r="audioFile-"+(new Date).getTime(),o={Bucket:"lucaeffe-rcs-podcast",Key:r+".mp3",Body:t,ContentType:"audio/mpeg"},e.next=5,n.upload(o).promise();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.speechToS3Bucket=x;var g=function(){var e=u(c.default.mark((function e(t){var n,o,i,u;return c.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.substring(t.lastIndexOf("/")+1),console.log("BUCKET KEY",n),console.log("process.env.AWS_REGION",r.env),o={credentials:{accessKeyId:"AKIAVFQ4KCDO3GID4XSG",secretAccessKey:"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"},region:"eu-west-2"},i=new a.S3Client(o),e.next=7,s.getSignedUrl(i,new a.GetObjectCommand({Bucket:"lucaeffe-rcs-podcast",Key:n}),{expiresIn:900});case 7:return u=e.sent,console.log("Presigned URL: ",u),e.abrupt("return",u);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.getPresignedBucketUrl=g;var m=function(){var e=u(c.default.mark((function e(t,n){var r,o,a,s;return c.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="https://create-megaphone-episode-nps3rxjiya-ew.a.run.app/",o=new URLSearchParams({articleTitle:t,mp3Url:n}),console.log("queryString",o),console.log("URL","".concat(r,"?").concat(o)),e.next=6,fetch("".concat(r,"?").concat(o));case 6:return a=e.sent,e.next=9,a.json();case 9:return s=e.sent,console.log("podcastEpisode internal",s),e.abrupt("return",s);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();t.createMegaphonePodcastEpisode=m;var w=function(){var e=u(c.default.mark((function e(t){var n,r;return c.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="https://get-episode-detail-nps3rxjiya-ew.a.run.app/?episodeId=".concat(t),e.next=3,fetch(n);case 3:return r=e.sent,console.log("episodeDetail",r),e.next=7,r.json();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.getEpisodeDetail=w,e.exports={createMegaphonePodcastEpisode:m,textToSpeechAzure:v,textToSpeechReadSpeaker:f,textToSpeechReadSpeakerPoc:h,speechToS3Bucket:x,getPresignedBucketUrl:g,getEpisodeDetail:w}},3743:function(){},28022:function(){},3339:function(){},43108:function(){},88275:function(){},92505:function(){},10146:function(){},30173:function(){},41137:function(){},10592:function(){}},function(e){e.O(0,[774,586,179,9,888,377],(function(){return t=33685,e(e.s=t);var t}));var t=e.O();_N_E=t}]);